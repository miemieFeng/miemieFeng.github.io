{
    "version": "https://jsonfeed.org/version/1",
    "title": "咩咩君 • All posts by \"uni-app\" category",
    "description": "coding日常",
    "home_page_url": "http://miemieFeng.github.io",
    "items": [
        {
            "id": "http://miemiefeng.github.io/uni-app%E5%B0%81%E8%A3%85%E5%85%AC%E5%85%B1%E8%AF%B7%E6%B1%82(%E6%90%BA%E5%B8%A6token)/",
            "url": "http://miemiefeng.github.io/uni-app%E5%B0%81%E8%A3%85%E5%85%AC%E5%85%B1%E8%AF%B7%E6%B1%82(%E6%90%BA%E5%B8%A6token)/",
            "title": "uni-app封装公共请求(携带token)",
            "date_published": "2021-12-24T05:21:40.000Z",
            "content_html": "<blockquote>\n<p>在日常开发过程中，一般请求我们都会携带 token, 以保证安全性</p>\n</blockquote>\n<h3 id=\"1-在工程目录下新建个common文件夹\"><a class=\"markdownIt-Anchor\" href=\"#1-在工程目录下新建个common文件夹\">#</a> 1、在工程目录下新建个 common 文件夹</h3>\n<p>在 common 目录下新增 request.js</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//请求函数</span><br><span class=\"line\">const request = (url = &#x27;&#x27;, data = &#123;&#125;,type = &#x27;POST&#x27;, header = &#123;&#125;) =&gt; &#123;</span><br><span class=\"line\">\t// 缓存中获取token </span><br><span class=\"line\">\t header.token = data.token? data.token:uni.getStorageSync(&#x27;token&#x27;);</span><br><span class=\"line\">\t //请求地址</span><br><span class=\"line\">\t var baseUrl =  &#x27;http://localhost:9001/v1/openApi/&#x27;;  </span><br><span class=\"line\">    return new Promise((resolve, reject) =&gt; &#123;</span><br><span class=\"line\">        uni.request(&#123;</span><br><span class=\"line\">            method: type,</span><br><span class=\"line\">            url: baseUrl +url,</span><br><span class=\"line\">            data: data,</span><br><span class=\"line\">            header: header,</span><br><span class=\"line\">            dataType: &#x27;json&#x27;,        </span><br><span class=\"line\">        &#125;).then((response) =&gt; &#123;</span><br><span class=\"line\">            uni.hideLoading();</span><br><span class=\"line\">            uni.stopPullDownRefresh();</span><br><span class=\"line\">            let [error, res] = response;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\tconsole.log(res,&#x27;res&#x27;);</span><br><span class=\"line\">            if(res.data.code == 200)&#123;</span><br><span class=\"line\">                setTimeout(function () &#123;</span><br><span class=\"line\">                    resolve(res.data);</span><br><span class=\"line\">                &#125;, 1000);</span><br><span class=\"line\">            &#125;else if(res.data.code == 401)&#123;   //token失效时重新登录</span><br><span class=\"line\">                uni.showToast(&#123;</span><br><span class=\"line\">                    title:res.data.msg,</span><br><span class=\"line\">                    image:&#x27;../../static/public/close.png&#x27;,</span><br><span class=\"line\">                    duration: 2000,</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">\t\t\t\tsetTimeout(function()&#123;</span><br><span class=\"line\">\t\t\t\t\tuni.navigateTo(&#123;</span><br><span class=\"line\">\t\t\t\t\t    url: &#x27;/pages/login/login_vfcode&#x27;,</span><br><span class=\"line\">\t\t\t\t\t\tcomplete(e)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\tconsole.log(e,&#x27;eeeeeeeeee&#x27;)</span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t&#125;);</span><br><span class=\"line\">\t\t\t\t&#125;,1000);</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">            &#125; else if(res.data.code == -100)&#123;   //-100时返回处理</span><br><span class=\"line\">\t\t\tuni.showToast(&#123;</span><br><span class=\"line\">\t\t\t    title:res.data.msg,</span><br><span class=\"line\">\t\t\t    duration: 1000,</span><br><span class=\"line\">\t\t\t&#125;);</span><br><span class=\"line\">\t\t\tsetTimeout(function () &#123;</span><br><span class=\"line\">\t\t\t\t//回调</span><br><span class=\"line\">\t\t\t    resolve(res.data);</span><br><span class=\"line\">\t\t\t&#125;, 1000);</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">            &#125;else &#123;  //其它code 返回提示</span><br><span class=\"line\">                uni.showToast(&#123;</span><br><span class=\"line\">                    title:res.data.msg,</span><br><span class=\"line\">                    image:&#x27;../../static/public/close.png&#x27;,</span><br><span class=\"line\">                    duration: 2000,</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;).catch(error =&gt; &#123;</span><br><span class=\"line\">            uni.hideLoading();</span><br><span class=\"line\">            uni.stopPullDownRefresh();</span><br><span class=\"line\">            let [err, res] = error;</span><br><span class=\"line\">            reject(err)</span><br><span class=\"line\">\t\t\tconsole.log(error ,&#x27;请求返回error&#x27;)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">//定义对象</span><br><span class=\"line\">var api = &#123;</span><br><span class=\"line\">\trequest</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"> </span><br><span class=\"line\">export default api</span><br></pre></td></tr></table></figure>\n<p>这里我是把 token 加到了请求头里</p>\n<h3 id=\"2-在-mainjs-中引入-定义\"><a class=\"markdownIt-Anchor\" href=\"#2-在-mainjs-中引入-定义\">#</a> 2、在 main.js 中引入、定义</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import request from &#x27;common/request.js&#x27;  //引入封装全局</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\">Vue.prototype.$api = request  </span><br></pre></td></tr></table></figure>\n<h3 id=\"3-实际使用\"><a class=\"markdownIt-Anchor\" href=\"#3-实际使用\">#</a> 3、实际使用</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">this.$api.request(&#x27;getBookingList&#x27;, </span><br><span class=\"line\">\t\t&#123;time: &#x27;2021-11-10&#x27;&#125;, </span><br><span class=\"line\">\t\t&#x27;post&#x27;).then((res) =&gt; &#123;</span><br><span class=\"line\">\tconsole.log(res, &#x27;res----&#x27;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "前端"
            ]
        }
    ]
}